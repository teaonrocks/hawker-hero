<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Edit Stall - <%= stall.name %></title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
			rel="stylesheet"
		/>
	</head>
	<body>
		<%- include('partials/navbar') %> <%- include('partials/flash-messages') %>

		<div class="container mt-4">
			<div class="row justify-content-center">
				<div class="col-md-8">
					<div class="card">
						<div class="card-header">
							<h2>
								<i class="bi bi-pencil-square"></i> Edit Stall - <%= stall.name
								%>
							</h2>
						</div>
						<div class="card-body">
							<!-- Fixed: Proper method override for PUT -->
							<form method="POST" action="/stalls/<%= stall.id %>?_method=PUT" enctype="multipart/form-data">
								<div class="mb-3">
									<label for="name" class="form-label"
										>Stall Name <span class="text-danger">*</span></label
									>
									<input
										type="text"
										name="name"
										id="name"
										class="form-control"
										value="<%= stall.name %>"
										required
									/>
								</div>

								<div class="mb-3">
									<label for="location" class="form-label"
										>Location <span class="text-danger">*</span></label
									>
									<input
										type="text"
										name="location"
										id="location"
										class="form-control"
										value="<%= stall.location %>"
										required
									/>
								</div>

								<div class="mb-3">
									<label for="cuisine_type" class="form-label"
										>Cuisine Type <span class="text-danger">*</span></label
									>
									<input
										type="text"
										name="cuisine_type"
										id="cuisine_type"
										class="form-control"
										value="<%= stall.cuisine_type %>"
										required
									/>
								</div>

								<div class="mb-3">
									<label for="center_id" class="form-label"
										>Hawker Center <span class="text-danger">*</span></label
									>
									<select name="center_id" id="center_id" class="form-select" required>
										<option value="">Select a hawker center</option>
										<% if (centers && centers.length > 0) { %>
											<% centers.forEach(center => { %>
											<option value="<%= center.id %>" <%= stall.center_id == center.id ? 'selected' : '' %>><%= center.name %></option>
											<% }); %>
										<% } %>
									</select>
								</div>

								<div class="mb-3">
									<label for="opening_hours" class="form-label">Opening Hours</label>
									<input
										type="text"
										name="opening_hours"
										id="opening_hours"
										class="form-control"
										value="<%= stall.opening_hours || '' %>"
										placeholder="e.g., 9:00 AM - 6:00 PM"
									/>
								</div>

								<div class="mb-3">
									<label for="image" class="form-label">Image</label>
									<% if (stall.image_url) { %>
									<div class="mb-2">
										<img
											src="/images/<%= stall.image_url %>"
											alt="<%= stall.name %>"
											class="img-thumbnail"
											style="max-width: 200px"
										/>
										<div class="form-text">Current image</div>
									</div>
									<% } %>
									<input type="file" class="form-control" id="image" name="image" accept="image/*">
									<div class="form-text">Leave empty to keep current image</div>
								</div>

								<div class="d-grid gap-2 d-md-flex justify-content-md-end">
									<a href="/stalls" class="btn btn-secondary me-md-2">
										<i class="bi bi-arrow-left"></i> Cancel
									</a>
									<button type="submit" class="btn btn-primary">
										<i class="bi bi-check-circle"></i> Update Stall
									</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
