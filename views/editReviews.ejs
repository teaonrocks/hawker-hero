<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title><%= title %></title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
</head>

<body>
	<%- include('partials/navbar') %>
	<%- include('partials/flash-messages') %>

	<div class="container mt-4">
		<h1 class="mb-4"><i class="bi bi-pencil-square"></i> Edit Review</h1>

		<!-- ✅ Updated form to POST and accept file uploads -->
		<form action="/editReviews/<%= formData?.id %>" method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
			<div class="mb-3">
				<label for="stall_id" class="form-label">Stall</label>
				<select class="form-select" id="stall_id" name="stall_id" required>
					<% stalls.forEach(stall => { %>
						<option value="<%= stall.id %>" <%= formData.stall_id === stall.id ? 'selected' : '' %>>
							<%= stall.name %>
						</option>
					<% }) %>
				</select>
			</div>

			<div class="mb-3">
				<label for="rating" class="form-label">Rating (1–5)</label>
				<input type="number" class="form-control" id="rating" name="rating" min="1" max="5" required value="<%= formData.rating %>">
			</div>

			<% if (formData.image_url) { %>
				<div class="mb-3">
					<p>Current Image:</p>
					<img src="<%= formData.image_url %>" alt="Review image" class="img-thumbnail" style="max-width: 200px;">
				</div>
			<% } %>

			<div class="mb-3">
				<label for="image" class="form-label">Upload New Image (optional)</label>
				<input type="file" class="form-control" id="image" name="image" accept="image/*">
			</div>

			<div class="mb-3">
				<label for="comment" class="form-label">Comment</label>
				<textarea class="form-control" id="comment" name="comment" rows="4" required><%= formData.comment %></textarea>
			</div>

			<div class="d-flex justify-content-between">
				<a href="/reviews" class="btn btn-secondary">
					<i class="bi bi-arrow-left"></i> Cancel
				</a>
				<button type="submit" class="btn btn-success">
					<i class="bi bi-check-circle"></i> Save Changes
				</button>
			</div>
		</form>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
